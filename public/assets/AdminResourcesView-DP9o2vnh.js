import{A as W}from"./AdminLayout-BpZxRoLy.js";import{I as T,a as A}from"./IconSearch-DFj2vtNF.js";import{c as R,b as x,m as L,f as E,_ as G,s as d,x as l,g as u,h as e,t as a,k as U,l as m,v as w,o as p,i as g,E as S,B as N,D as O,F as V,C as F,w as M,n as b,p as B,q as f}from"./index-BNAkoScm.js";import{I as z,S as X,F as q,M as K}from"./SuccessToast-C84kOOQ4.js";import{I as H}from"./IconUser-BNC5_a45.js";import{a as j}from"./admin_user-CbaLGgfr.js";import{l as J}from"./LoadingOverlay-DZHg7Lb1.js";const Y={components:{IconSearch:T,IconEyeOpen:R,IconEyeClose:x,IconEdit:z,IconUser:H,IconX:A,SuccessToast:X,FailToast:q,Modal:K},data(){return{users:[],userDetail:null,isEdit:!1,updateId:null,limit:10,offset:1,totalCount:0,searchText:"",submitting:!1,errorMsg:"",saveSuccess:!1,saveError:!1,showPswModal:!1,confirmPsw:"",showPassword:!1,missingPassword:!1,deleteUserId:null}},computed:{...L(j,J),canEdit(){return this.adminUserStore.roleId>1},usersNum(){return this.users.length},hasResult(){return this.usersNum>0},pageCount(){return this.totalCount<1?0:Math.ceil(this.totalCount/this.limit)},passwordInputType(){return this.showPassword?"text":"password"}},methods:{clearErrors(){this.missingPassword=!1},toogleShowPassword(){this.showPassword=!this.showPassword},paginateLeft(){this.offset<2||(this.offset--,this.fetchUsers(null,this.offset))},paginatRight(){this.offset>=this.pageCount||(this.offset++,this.fetchUsers(null,this.offset))},fetchUsers(o,s=1){let h={s,l:parseInt(this.limit),st:this.searchText};this.loadingStore.startLoading(),E.get("/api/admin/users?"+new URLSearchParams(h).toString()).then(c=>{this.users=c.data.users,this.totalCount=c.data.result_count,this.offset=s,this.loadingStore.finishLoading()}).catch(c=>{this.loadingStore.finishLoading(),console.log(c),this.errorMsg=c.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})},viewUser(o){this.userDetail=o},viewEditUser(o){this.isEdit=!0,this.updateId=o.id,this.userDetail={...o}},closeDetail(){this.isEdit=!1,this.userDetail=null,this.updateId=null},createNewUser(){this.isEdit=!0,this.userDetail={id:0,username:null,password:null,email:null,lg:null,country:null,city:null,description:null,profile_img:null,ip:null,device_data:null,created_at:null}},cancelAction(){this.showPswModal=!1,this.confirmPsw="",this.deleteUserId=null},performAction(){if(this.confirmPsw.length<1){this.missingPassword=!0;return}let o=null;if(this.deleteUserId)o={method:"DELETE",psw:this.confirmPsw,delete_id:this.deleteUserId},this.postData(o);else if(this.isEdit&&this.userDetail)if(this.userDetail.id>0&&this.updateId){o={method:"UPDATE",psw:this.confirmPsw,user_id:this.userDetail.id};let s=this.users.find(c=>c.id==this.updateId);if(!s){this.showPswModal=!1,this.updateId=null,this.userDetail=null,this.confirmPsw="",this.errorMsg="Unable to find original user!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3);return}let h=!1;if(s.username!==this.userDetail.username.trim()&&(o.username=this.userDetail.username.trim(),h=!0),this.userDetail.email&&s.email!==this.userDetail.email&&this.userDetail.email.trim().length>6&&this.userDetail.email.includes("@")&&(o.email=this.userDetail.email.trim(),h=!0),s.lg!==this.userDetail.lg&&(o.lg=this.userDetail.lg,h=!0),this.userDetail.country&&s.country!==this.userDetail.country.trim()&&(o.country=this.userDetail.country.trim(),h=!0),this.userDetail.city&&s.city!==this.userDetail.city.trim()&&(o.city=this.userDetail.city.trim(),h=!0),this.userDetail.description&&s.description!==this.userDetail.description.trim()&&(o.description=this.userDetail.description.trim(),h=!0),this.userDetail.ip&&s.ip!==this.userDetail.ip.trim()&&(o.ip=this.userDetail.ip.trim(),h=!0),this.userDetail.device_data&&s.device_data!==this.userDetail.device_data.trim()&&(o.device_data=this.userDetail.device_data.trim(),h=!0),h)this.postData(o);else{this.errorMsg="Nothing to update!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}}else{if(o={method:"CREATE",psw:this.confirmPsw},this.userDetail.username&&this.userDetail.username.trim().length>0)o.username=this.userDetail.username.trim();else{this.errorMsg="Username is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}if(this.userDetail.password&&this.userDetail.password.trim().length>5)o.password=this.userDetail.password.trim();else{this.errorMsg="Password is required! And 6 or more character",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}if(this.userDetail.email&&this.userDetail.email.trim().length>6&&this.userDetail.email.includes("@")&&(o.email=this.userDetail.email.trim()),this.userDetail.lg)o.lg=this.userDetail.lg;else{this.errorMsg="Language is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}this.userDetail.country&&this.userDetail.country.trim().length>0&&(o.country=this.userDetail.country.trim()),this.userDetail.city&&this.userDetail.city.trim().length>0&&(o.city=this.userDetail.city.trim()),this.userDetail.description&&this.userDetail.description.trim().length>0&&(o.description=this.userDetail.description.trim()),this.userDetail.ip&&this.userDetail.ip.trim().length>0&&(o.ip=this.userDetail.ip.trim()),this.userDetail.device_data&&this.userDetail.device_data.trim().length>0&&(o.device_data=this.userDetail.device_data.trim()),this.postData(o)}else this.cancelAction()},deleteUser(o){this.deleteUserId=o,this.isEdit=!1,this.updateId=null,this.userDetail=null,this.showPswModal=!0,this.focusOnPassword()},saveUser(){this.deleteUserId=null,this.isEdit&&(this.showPswModal=!0,this.focusOnPassword())},focusOnPassword(){setTimeout(()=>{document.getElementById("password_input").focus()},300)},postData(o){this.loadingStore.startLoading(),this.showPswModal=!1,E.post("/api/admin/users",o).then(()=>{this.loadingStore.finishLoading(),this.deleteUserId=null,this.confirmPsw="",this.fetchUsers(null,1),this.saveSuccess=!0,setTimeout(()=>{this.saveSuccess=!1},3e3)}).catch(s=>{this.loadingStore.finishLoading(),this.deleteUserId=null,this.updateId=null,this.userDetail=null,this.confirmPsw="",console.log(s),this.errorMsg=s.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})}}},Z={class:"resurce"},$={key:0,class:"detail-container"},ss={class:"details-header"},es=["readonly"],ts={class:"mt-2"},is=["src"],rs={key:1,class:"icon-lg"},os={class:"detail"},ns={key:0},ls=["readonly"],us=["readonly"],as=["disabled"],ds=["readonly"],ps=["readonly"],hs=["readonly"],cs=["readonly"],ms=["readonly"],gs={key:1},fs={class:"resurce-control"},ws={class:"password-container"},_s=["disabled"],Ds=["disabled"],ys={class:"icon"},vs=["onClick"],Us=["onClick"],bs=["onClick"],Es={key:0,class:"text-center mt-2"},Ps=["disabled"],Is={class:"mr-1 ml-1"},Cs=["disabled"],ks={class:"password-container"},Gs=["type"],Ss={class:"icon"},Ms={key:0,class:"invalid-text"};function Ts(o,s,h,c,t,i){const D=d("IconUser"),_=d("IconSearch"),y=d("IconEyeOpen"),v=d("IconEdit"),P=d("IconX"),I=d("IconEyeClose"),C=d("Modal"),k=d("SuccessToast"),r=d("FailToast");return l(),u("div",Z,[t.userDetail?(l(),u("div",$,[e("div",ss,[e("h2",null,[e("span",null,"#"+a(t.userDetail.id),1),s[23]||(s[23]=U()),m(e("input",{type:"text",name:"username",readonly:!t.isEdit,"onUpdate:modelValue":s[0]||(s[0]=n=>t.userDetail.username=n)},null,8,es),[[w,t.userDetail.username]])]),e("div",null,[t.isEdit?(l(),u("button",{key:0,class:"btn btn-success mr-2",onClick:s[1]||(s[1]=(...n)=>i.saveUser&&i.saveUser(...n))},"Save")):p("",!0),e("button",{class:"btn-sm btn-secondary",onClick:s[2]||(s[2]=(...n)=>i.closeDetail&&i.closeDetail(...n))},"X")])]),e("div",ts,[t.userDetail.profile_img?(l(),u("img",{key:0,src:t.userDetail.profile_img,alt:"Profile Image",class:"profile-img md"},null,8,is)):(l(),u("span",rs,[g(D)]))]),e("div",os,[t.userDetail.id==0?(l(),u("p",ns,[s[24]||(s[24]=e("b",null,"Password: ",-1)),m(e("input",{type:"text",name:"pass",readonly:!t.isEdit,"onUpdate:modelValue":s[3]||(s[3]=n=>t.userDetail.password=n)},null,8,ls),[[w,t.userDetail.password]])])):p("",!0),e("p",null,[s[25]||(s[25]=e("b",null,"E-mail: ",-1)),m(e("input",{type:"text",name:"email",readonly:!t.isEdit,"onUpdate:modelValue":s[4]||(s[4]=n=>t.userDetail.email=n)},null,8,us),[[w,t.userDetail.email]])]),e("p",null,[s[27]||(s[27]=e("b",null,"Language: ",-1)),s[28]||(s[28]=U()),m(e("select",{name:"user_lg",id:"user_lg",disabled:!t.isEdit,"onUpdate:modelValue":s[5]||(s[5]=n=>t.userDetail.lg=n)},s[26]||(s[26]=[e("option",{value:"HU"},"Magyar",-1),e("option",{value:"SR"},"Serbian",-1),e("option",{value:"EN"},"English",-1)]),8,as),[[S,t.userDetail.lg]])]),e("p",null,[s[29]||(s[29]=e("b",null,"Country: ",-1)),m(e("input",{type:"text",name:"country",readonly:!t.isEdit,"onUpdate:modelValue":s[6]||(s[6]=n=>t.userDetail.country=n)},null,8,ds),[[w,t.userDetail.country]])]),e("p",null,[s[30]||(s[30]=e("b",null,"City: ",-1)),m(e("input",{type:"text",name:"city",readonly:!t.isEdit,"onUpdate:modelValue":s[7]||(s[7]=n=>t.userDetail.city=n)},null,8,ps),[[w,t.userDetail.city]])]),e("p",null,[s[31]||(s[31]=e("b",null,"Description: ",-1)),m(e("textarea",{name:"description",readonly:!t.isEdit,"onUpdate:modelValue":s[8]||(s[8]=n=>t.userDetail.description=n)},null,8,hs),[[w,t.userDetail.description]])]),e("p",null,[s[32]||(s[32]=e("b",null,"IP: ",-1)),m(e("input",{type:"text",name:"ip",readonly:!t.isEdit,"onUpdate:modelValue":s[9]||(s[9]=n=>t.userDetail.ip=n)},null,8,cs),[[w,t.userDetail.ip]])]),e("p",null,[s[33]||(s[33]=e("b",null,"Device Data: ",-1)),m(e("textarea",{name:"device_data",readonly:!t.isEdit,"onUpdate:modelValue":s[10]||(s[10]=n=>t.userDetail.device_data=n)},null,8,ms),[[w,t.userDetail.device_data]])]),e("p",null,[s[34]||(s[34]=e("b",null,"Created At: ",-1)),U(a(t.userDetail.created_at),1)])])])):(l(),u("div",gs,[s[37]||(s[37]=e("h2",null,"Users",-1)),e("div",fs,[e("div",ws,[m(e("input",{id:"search_input",type:"text","onUpdate:modelValue":s[11]||(s[11]=n=>t.searchText=n),disabled:t.submitting,onKeypress:s[12]||(s[12]=N((...n)=>i.fetchUsers&&i.fetchUsers(...n),["enter"]))},null,40,_s),[[w,t.searchText]]),e("button",{type:"button",onClick:s[13]||(s[13]=(...n)=>i.fetchUsers&&i.fetchUsers(...n)),disabled:t.submitting},[e("span",ys,[g(_)])],8,Ds)]),e("div",null,[m(e("select",{name:"pag_size",id:"pag_size","onUpdate:modelValue":s[14]||(s[14]=n=>t.limit=n),onChange:s[15]||(s[15]=(...n)=>i.fetchUsers&&i.fetchUsers(...n))},s[35]||(s[35]=[O('<option value="2">2 / page</option><option value="10">10 / page</option><option value="15">15 / page</option><option value="20">20 / page</option><option value="25">25 / page</option>',5)]),544),[[S,t.limit]]),e("button",{class:"btn-sm btn-primary",onClick:s[16]||(s[16]=(...n)=>i.fetchUsers&&i.fetchUsers(...n))},"Fetch All Users"),i.canEdit?(l(),u("button",{key:0,class:"btn-sm btn-success ml-2",onClick:s[17]||(s[17]=(...n)=>i.createNewUser&&i.createNewUser(...n))},"Create New User")):p("",!0)])]),e("table",null,[s[36]||(s[36]=e("tr",null,[e("th",null,"ID"),e("th",null,"Name"),e("th",null,"E-mail"),e("th",null,"Language"),e("th",null,"Country"),e("th",null,"City"),e("th",null,"Description"),e("th",null,"Created At"),e("th",null,"Actions")],-1)),(l(!0),u(V,null,F(t.users,n=>(l(),u("tr",{key:n.id},[e("td",null,a(n.id),1),e("td",null,a(n.username),1),e("td",null,a(n.email),1),e("td",null,a(n.lg),1),e("td",null,a(n.country),1),e("td",null,a(n.city),1),e("td",null,a(n.description),1),e("td",null,a(n.created_at),1),e("td",null,[e("span",{class:"icon-edit-btn ml-1",onClick:Q=>i.viewUser(n)},[g(y)],8,vs),i.canEdit?(l(),u("span",{key:0,class:"icon-edit-btn ml-1",onClick:Q=>i.viewEditUser(n)},[g(v)],8,Us)):p("",!0),i.canEdit?(l(),u("span",{key:1,class:"icon-edit-btn danger ml-1",onClick:Q=>i.deleteUser(n.id)},[g(P)],8,bs)):p("",!0)])]))),128))]),i.hasResult?(l(),u("div",Es,[e("button",{type:"button",class:"btn pag-btn",disabled:t.offset==1,onClick:s[18]||(s[18]=(...n)=>i.paginateLeft&&i.paginateLeft(...n))},"<",8,Ps),e("span",Is,"Page: "+a(t.offset)+" / "+a(i.pageCount)+" All Resource: "+a(t.totalCount),1),e("button",{type:"button",class:"btn pag-btn",onClick:s[19]||(s[19]=(...n)=>i.paginatRight&&i.paginatRight(...n)),disabled:t.offset>=i.pageCount},">",8,Cs)])):p("",!0)])),g(C,{show:t.showPswModal,size:"sm",title:"Confirmtion Admin Password",showCancel:!0,onClose:i.cancelAction,onCancel:i.cancelAction,onOk:i.performAction},{default:M(()=>[e("div",null,[s[38]||(s[38]=e("label",{for:"password_input"},[U("Admin Update Password"),e("span",null,"*")],-1)),e("div",ks,[m(e("input",{id:"password_input",type:i.passwordInputType,class:b({"invalid-input":t.missingPassword}),"onUpdate:modelValue":s[20]||(s[20]=n=>t.confirmPsw=n),onInput:s[21]||(s[21]=(...n)=>i.clearErrors&&i.clearErrors(...n))},null,42,Gs),[[B,t.confirmPsw]]),e("button",{type:"button",onClick:s[22]||(s[22]=(...n)=>i.toogleShowPassword&&i.toogleShowPassword(...n))},[e("span",Ss,[t.showPassword?(l(),f(I,{key:0})):(l(),f(y,{key:1}))])])]),t.missingPassword?(l(),u("p",Ms,"Please Enter your Admin Update Password!")):p("",!0)])]),_:1},8,["show","onClose","onCancel","onOk"]),t.saveSuccess?(l(),f(k,{key:2})):p("",!0),t.saveError?(l(),f(r,{key:3,msg:t.errorMsg},null,8,["msg"])):p("",!0)])}const As=G(Y,[["render",Ts]]),Rs={components:{IconSearch:T,IconEyeOpen:R,IconEyeClose:x,IconEdit:z,IconUser:H,IconX:A,SuccessToast:X,FailToast:q,Modal:K},data(){return{groups:[],groupDetail:null,isEdit:!1,updateId:null,limit:10,offset:1,totalCount:0,searchText:"",submitting:!1,errorMsg:"",saveSuccess:!1,saveError:!1,showPswModal:!1,confirmPsw:"",showPassword:!1,missingPassword:!1,deleteGroupId:null}},computed:{...L(j,J),canEdit(){return this.adminUserStore.roleId>1},groupNum(){return this.groups.length},hasResult(){return this.groupNum>0},pageCount(){return this.totalCount<1?0:Math.ceil(this.totalCount/this.limit)},passwordInputType(){return this.showPassword?"text":"password"}},methods:{clearErrors(){this.missingPassword=!1},toogleShowPassword(){this.showPassword=!this.showPassword},paginateLeft(){this.offset<2||(this.offset--,this.fetchGroups(null,this.offset))},paginatRight(){this.offset>=this.pageCount||(this.offset++,this.fetchGroups(null,this.offset))},fetchGroups(o,s=1){let h={s,l:parseInt(this.limit),st:this.searchText};this.loadingStore.startLoading(),E.get("/api/admin/groups?"+new URLSearchParams(h).toString()).then(c=>{this.groups=c.data.groups,this.totalCount=c.data.result_count,this.offset=s,this.loadingStore.finishLoading()}).catch(c=>{this.loadingStore.finishLoading(),console.log(c),this.errorMsg=c.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})},viewGroup(o){this.groupDetail=o},viewEditGroup(o){this.isEdit=!0,this.updateId=o.id,this.groupDetail={...o}},closeDetail(){this.isEdit=!1,this.groupDetail=null,this.updateId=null},createNewGroup(){this.isEdit=!0,this.groupDetail={id:0,main_user:null,group_name:null,created_at:null}},cancelAction(){this.showPswModal=!1,this.confirmPsw="",this.deleteGroupId=null},performAction(){if(this.confirmPsw.length<1){this.missingPassword=!0;return}let o=null;if(this.deleteGroupId)o={method:"DELETE",psw:this.confirmPsw,delete_id:this.deleteGroupId},this.postData(o);else if(this.isEdit&&this.groupDetail)if(this.groupDetail.id>0&&this.updateId){o={method:"UPDATE",psw:this.confirmPsw,group_id:this.groupDetail.id};let s=this.groups.find(c=>c.id==this.updateId);if(!s){this.showPswModal=!1,this.updateId=null,this.groupDetail=null,this.confirmPsw="",this.errorMsg="Unable to find original group!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3);return}let h=!1;if(s.main_user!==parseInt(this.groupDetail.main_user)&&(o.main_user=parseInt(this.groupDetail.main_user),h=!0),s.group_name!==this.groupDetail.group_name.trim()&&(o.group_name=this.groupDetail.group_name.trim(),h=!0),h)this.postData(o);else{this.errorMsg="Nothing to update!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}}else{if(o={method:"CREATE",psw:this.confirmPsw},this.groupDetail.main_user)o.main_user=parseInt(this.groupDetail.main_user);else{this.errorMsg="Main User Id is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}if(this.groupDetail.group_name&&this.groupDetail.group_name.trim().length>1)o.group_name=this.groupDetail.group_name.trim();else{this.errorMsg="Group Name is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}this.postData(o)}else this.cancelAction()},deleteGroup(o){this.deleteGroupId=o,this.isEdit=!1,this.updateId=null,this.groupDetail=null,this.showPswModal=!0,this.focusOnPassword()},saveDetail(){this.deleteGroupId=null,this.isEdit&&(this.showPswModal=!0,this.focusOnPassword())},focusOnPassword(){setTimeout(()=>{document.getElementById("password_input").focus()},300)},postData(o){this.loadingStore.startLoading(),this.showPswModal=!1,E.post("/api/admin/groups",o).then(()=>{this.loadingStore.finishLoading(),this.deleteGroupId=null,this.confirmPsw="",this.fetchGroups(null,1),this.saveSuccess=!0,setTimeout(()=>{this.saveSuccess=!1},3e3)}).catch(s=>{this.loadingStore.finishLoading(),this.deleteGroupId=null,this.updateId=null,this.groupDetail=null,this.confirmPsw="",console.log(s),this.errorMsg=s.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})}}},xs={class:"resurce"},Ls={key:0,class:"detail-container"},Ns={class:"details-header"},Os={key:0},Vs={class:"detail"},Fs=["readonly"],Bs=["readonly"],zs={key:1},Xs={class:"resurce-control"},qs={class:"password-container"},Ks=["disabled"],Hs=["disabled"],js={class:"icon"},Js=["onClick"],Qs=["onClick"],Ws=["onClick"],Ys={key:0,class:"text-center mt-2"},Zs=["disabled"],$s={class:"mr-1 ml-1"},se=["disabled"],ee={class:"password-container"},te=["type"],ie={class:"icon"},re={key:0,class:"invalid-text"};function oe(o,s,h,c,t,i){const D=d("IconSearch"),_=d("IconEyeOpen"),y=d("IconEdit"),v=d("IconX"),P=d("IconEyeClose"),I=d("Modal"),C=d("SuccessToast"),k=d("FailToast");return l(),u("div",xs,[t.groupDetail?(l(),u("div",Ls,[e("div",Ns,[e("h2",null,[t.groupDetail.id>0?(l(),u("span",Os,"#"+a(t.groupDetail.id),1)):p("",!0)]),e("div",null,[t.isEdit?(l(),u("button",{key:0,class:"btn btn-success mr-2",onClick:s[0]||(s[0]=(...r)=>i.saveDetail&&i.saveDetail(...r))},"Save")):p("",!0),e("button",{class:"btn-sm btn-secondary",onClick:s[1]||(s[1]=(...r)=>i.closeDetail&&i.closeDetail(...r))},"X")])]),e("div",Vs,[e("p",null,[s[16]||(s[16]=e("b",null,"Main User Id: ",-1)),m(e("input",{type:"number",name:"main_user",readonly:!t.isEdit,"onUpdate:modelValue":s[2]||(s[2]=r=>t.groupDetail.main_user=r)},null,8,Fs),[[w,t.groupDetail.main_user]])]),e("p",null,[s[17]||(s[17]=e("b",null,"Group Name: ",-1)),m(e("input",{type:"text",name:"group_name",readonly:!t.isEdit,"onUpdate:modelValue":s[3]||(s[3]=r=>t.groupDetail.group_name=r)},null,8,Bs),[[w,t.groupDetail.group_name]])]),e("p",null,[s[18]||(s[18]=e("b",null,"Created At: ",-1)),U(a(t.groupDetail.created_at),1)])])])):(l(),u("div",zs,[s[21]||(s[21]=e("h2",null,"Groups",-1)),e("div",Xs,[e("div",qs,[m(e("input",{id:"search_input",type:"text","onUpdate:modelValue":s[4]||(s[4]=r=>t.searchText=r),disabled:t.submitting,onKeypress:s[5]||(s[5]=N((...r)=>i.fetchGroups&&i.fetchGroups(...r),["enter"]))},null,40,Ks),[[w,t.searchText]]),e("button",{type:"button",onClick:s[6]||(s[6]=(...r)=>i.fetchGroups&&i.fetchGroups(...r)),disabled:t.submitting},[e("span",js,[g(D)])],8,Hs)]),e("div",null,[m(e("select",{name:"pag_size",id:"pag_size","onUpdate:modelValue":s[7]||(s[7]=r=>t.limit=r),onChange:s[8]||(s[8]=(...r)=>i.fetchGroups&&i.fetchGroups(...r))},s[19]||(s[19]=[O('<option value="2">2 / page</option><option value="10">10 / page</option><option value="15">15 / page</option><option value="20">20 / page</option><option value="25">25 / page</option>',5)]),544),[[S,t.limit]]),e("button",{class:"btn-sm btn-primary",onClick:s[9]||(s[9]=(...r)=>i.fetchGroups&&i.fetchGroups(...r))},"Fetch All Groups"),i.canEdit?(l(),u("button",{key:0,class:"btn-sm btn-success ml-2",onClick:s[10]||(s[10]=(...r)=>i.createNewGroup&&i.createNewGroup(...r))},"Create New Group")):p("",!0)])]),e("table",null,[s[20]||(s[20]=e("tr",null,[e("th",null,"ID"),e("th",null,"Main User Id"),e("th",null,"Group Name"),e("th",null,"Created At"),e("th",null,"Actions")],-1)),(l(!0),u(V,null,F(t.groups,r=>(l(),u("tr",{key:r.id},[e("td",null,a(r.id),1),e("td",null,a(r.main_user),1),e("td",null,a(r.group_name),1),e("td",null,a(r.created_at),1),e("td",null,[e("span",{class:"icon-edit-btn ml-1",onClick:n=>i.viewGroup(r)},[g(_)],8,Js),i.canEdit?(l(),u("span",{key:0,class:"icon-edit-btn ml-1",onClick:n=>i.viewEditGroup(r)},[g(y)],8,Qs)):p("",!0),i.canEdit?(l(),u("span",{key:1,class:"icon-edit-btn danger ml-1",onClick:n=>i.deleteGroup(r.id)},[g(v)],8,Ws)):p("",!0)])]))),128))]),i.hasResult?(l(),u("div",Ys,[e("button",{type:"button",class:"btn pag-btn",disabled:t.offset==1,onClick:s[11]||(s[11]=(...r)=>i.paginateLeft&&i.paginateLeft(...r))},"<",8,Zs),e("span",$s,"Page: "+a(t.offset)+" / "+a(i.pageCount)+" All Resource: "+a(t.totalCount),1),e("button",{type:"button",class:"btn pag-btn",onClick:s[12]||(s[12]=(...r)=>i.paginatRight&&i.paginatRight(...r)),disabled:t.offset>=i.pageCount},">",8,se)])):p("",!0)])),g(I,{show:t.showPswModal,size:"sm",title:"Confirmtion Admin Password",showCancel:!0,onClose:i.cancelAction,onCancel:i.cancelAction,onOk:i.performAction},{default:M(()=>[e("div",null,[s[22]||(s[22]=e("label",{for:"password_input"},[U("Admin Update Password"),e("span",null,"*")],-1)),e("div",ee,[m(e("input",{id:"password_input",type:i.passwordInputType,class:b({"invalid-input":t.missingPassword}),"onUpdate:modelValue":s[13]||(s[13]=r=>t.confirmPsw=r),onInput:s[14]||(s[14]=(...r)=>i.clearErrors&&i.clearErrors(...r))},null,42,te),[[B,t.confirmPsw]]),e("button",{type:"button",onClick:s[15]||(s[15]=(...r)=>i.toogleShowPassword&&i.toogleShowPassword(...r))},[e("span",ie,[t.showPassword?(l(),f(P,{key:0})):(l(),f(_,{key:1}))])])]),t.missingPassword?(l(),u("p",re,"Please Enter your Admin Update Password!")):p("",!0)])]),_:1},8,["show","onClose","onCancel","onOk"]),t.saveSuccess?(l(),f(C,{key:2})):p("",!0),t.saveError?(l(),f(k,{key:3,msg:t.errorMsg},null,8,["msg"])):p("",!0)])}const ne=G(Rs,[["render",oe]]),le={components:{IconSearch:T,IconEyeOpen:R,IconEyeClose:x,IconEdit:z,IconUser:H,IconX:A,SuccessToast:X,FailToast:q,Modal:K},data(){return{groupUsers:[],groupUserDetail:null,isEdit:!1,updateId:null,limit:10,offset:1,totalCount:0,searchText:"",submitting:!1,errorMsg:"",saveSuccess:!1,saveError:!1,showPswModal:!1,confirmPsw:"",showPassword:!1,missingPassword:!1,deleteGroupUserId:null}},computed:{...L(j,J),canEdit(){return this.adminUserStore.roleId>1},groupUserNum(){return this.groupUsers.length},hasResult(){return this.groupUserNum>0},pageCount(){return this.totalCount<1?0:Math.ceil(this.totalCount/this.limit)},passwordInputType(){return this.showPassword?"text":"password"}},methods:{clearErrors(){this.missingPassword=!1},toogleShowPassword(){this.showPassword=!this.showPassword},paginateLeft(){this.offset<2||(this.offset--,this.fetchGroupUsers(null,this.offset))},paginatRight(){this.offset>=this.pageCount||(this.offset++,this.fetchGroupUsers(null,this.offset))},fetchGroupUsers(o,s=1){let h={s,l:parseInt(this.limit),st:this.searchText};this.loadingStore.startLoading(),E.get("/api/admin/group-users?"+new URLSearchParams(h).toString()).then(c=>{this.groupUsers=c.data.group_users,this.totalCount=c.data.result_count,this.offset=s,this.loadingStore.finishLoading()}).catch(c=>{this.loadingStore.finishLoading(),console.log(c),this.errorMsg=c.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})},viewGroupUser(o){this.groupUserDetail=o},viewEditGroupUser(o){this.isEdit=!0,this.updateId=o.id,this.groupUserDetail={...o}},closeDetail(){this.isEdit=!1,this.groupUserDetail=null,this.updateId=null},createNewGroupUser(){this.isEdit=!0,this.groupUserDetail={id:0,group_id:null,user_id:null,created_at:null}},cancelAction(){this.showPswModal=!1,this.confirmPsw="",this.deleteGroupUserId=null},performAction(){if(this.confirmPsw.length<1){this.missingPassword=!0;return}let o=null;if(this.deleteGroupUserId)o={method:"DELETE",psw:this.confirmPsw,delete_id:this.deleteGroupUserId},this.postData(o);else if(this.isEdit&&this.groupUserDetail)if(this.groupUserDetail.id>0&&this.updateId){o={method:"UPDATE",psw:this.confirmPsw,group_user_id:this.groupUserDetail.id};let s=this.groupUsers.find(c=>c.id==this.updateId);if(!s){this.showPswModal=!1,this.updateId=null,this.groupUserDetail=null,this.confirmPsw="",this.errorMsg="Unable to find original group user!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3);return}let h=!1;if(s.group_id!==parseInt(this.groupUserDetail.group_id)&&(o.group_id=parseInt(this.groupUserDetail.group_id),h=!0),s.user_id!==parseInt(this.groupUserDetail.user_id)&&(o.user_id=parseInt(this.groupUserDetail.user_id),h=!0),h)this.postData(o);else{this.errorMsg="Nothing to update!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}}else{if(o={method:"CREATE",psw:this.confirmPsw},this.groupUserDetail.group_id)o.group_id=parseInt(this.groupUserDetail.group_id);else{this.errorMsg="Group Id is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}if(this.groupUserDetail.user_id)o.user_id=parseInt(this.groupUserDetail.user_id);else{this.errorMsg="User Id is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}this.postData(o)}else this.cancelAction()},deleteGroupUser(o){this.deleteGroupUserId=o,this.isEdit=!1,this.updateId=null,this.groupUserDetail=null,this.showPswModal=!0,this.focusOnPassword()},saveDetail(){this.deleteGroupUserId=null,this.isEdit&&(this.showPswModal=!0,this.focusOnPassword())},focusOnPassword(){setTimeout(()=>{document.getElementById("password_input").focus()},300)},postData(o){this.loadingStore.startLoading(),this.showPswModal=!1,E.post("/api/admin/group-users",o).then(()=>{this.loadingStore.finishLoading(),this.deleteGroupUserId=null,this.confirmPsw="",this.fetchGroupUsers(null,1),this.saveSuccess=!0,setTimeout(()=>{this.saveSuccess=!1},3e3)}).catch(s=>{this.loadingStore.finishLoading(),this.deleteGroupUserId=null,this.updateId=null,this.groupUserDetail=null,this.confirmPsw="",console.log(s),this.errorMsg=s.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})}}},ue={class:"resurce"},ae={key:0,class:"detail-container"},de={class:"details-header"},pe={key:0},he={class:"detail"},ce=["readonly"],me=["readonly"],ge={key:1},fe={class:"resurce-control"},we={class:"password-container"},_e=["disabled"],De=["disabled"],ye={class:"icon"},ve=["onClick"],Ue=["onClick"],be=["onClick"],Ee={key:0,class:"text-center mt-2"},Pe=["disabled"],Ie={class:"mr-1 ml-1"},Ce=["disabled"],ke={class:"password-container"},Ge=["type"],Se={class:"icon"},Me={key:0,class:"invalid-text"};function Te(o,s,h,c,t,i){const D=d("IconSearch"),_=d("IconEyeOpen"),y=d("IconEdit"),v=d("IconX"),P=d("IconEyeClose"),I=d("Modal"),C=d("SuccessToast"),k=d("FailToast");return l(),u("div",ue,[t.groupUserDetail?(l(),u("div",ae,[e("div",de,[e("h2",null,[t.groupUserDetail.id>0?(l(),u("span",pe,"#"+a(t.groupUserDetail.id),1)):p("",!0)]),e("div",null,[t.isEdit?(l(),u("button",{key:0,class:"btn btn-success mr-2",onClick:s[0]||(s[0]=(...r)=>i.saveDetail&&i.saveDetail(...r))},"Save")):p("",!0),e("button",{class:"btn-sm btn-secondary",onClick:s[1]||(s[1]=(...r)=>i.closeDetail&&i.closeDetail(...r))},"X")])]),e("div",he,[e("p",null,[s[16]||(s[16]=e("b",null,"Group Id: ",-1)),m(e("input",{type:"number",name:"group_id",readonly:!t.isEdit,"onUpdate:modelValue":s[2]||(s[2]=r=>t.groupUserDetail.group_id=r)},null,8,ce),[[w,t.groupUserDetail.group_id]])]),e("p",null,[s[17]||(s[17]=e("b",null,"User Id: ",-1)),m(e("input",{type:"number",name:"user_id",readonly:!t.isEdit,"onUpdate:modelValue":s[3]||(s[3]=r=>t.groupUserDetail.user_id=r)},null,8,me),[[w,t.groupUserDetail.user_id]])]),e("p",null,[s[18]||(s[18]=e("b",null,"Created At: ",-1)),U(a(t.groupUserDetail.created_at),1)])])])):(l(),u("div",ge,[s[21]||(s[21]=e("h2",null,"Group Users",-1)),e("div",fe,[e("div",we,[m(e("input",{id:"search_input",type:"text","onUpdate:modelValue":s[4]||(s[4]=r=>t.searchText=r),disabled:t.submitting,onKeypress:s[5]||(s[5]=N((...r)=>i.fetchGroupUsers&&i.fetchGroupUsers(...r),["enter"]))},null,40,_e),[[w,t.searchText]]),e("button",{type:"button",onClick:s[6]||(s[6]=(...r)=>i.fetchGroupUsers&&i.fetchGroupUsers(...r)),disabled:t.submitting},[e("span",ye,[g(D)])],8,De)]),e("div",null,[m(e("select",{name:"pag_size",id:"pag_size","onUpdate:modelValue":s[7]||(s[7]=r=>t.limit=r),onChange:s[8]||(s[8]=(...r)=>i.fetchGroupUsers&&i.fetchGroupUsers(...r))},s[19]||(s[19]=[O('<option value="2">2 / page</option><option value="10">10 / page</option><option value="15">15 / page</option><option value="20">20 / page</option><option value="25">25 / page</option>',5)]),544),[[S,t.limit]]),e("button",{class:"btn-sm btn-primary",onClick:s[9]||(s[9]=(...r)=>i.fetchGroupUsers&&i.fetchGroupUsers(...r))},"Fetch All Group Users"),i.canEdit?(l(),u("button",{key:0,class:"btn-sm btn-success ml-2",onClick:s[10]||(s[10]=(...r)=>i.createNewGroupUser&&i.createNewGroupUser(...r))},"Create New Group User")):p("",!0)])]),e("table",null,[s[20]||(s[20]=e("tr",null,[e("th",null,"ID"),e("th",null,"Group Id"),e("th",null,"User Id"),e("th",null,"Created At"),e("th",null,"Actions")],-1)),(l(!0),u(V,null,F(t.groupUsers,r=>(l(),u("tr",{key:r.id},[e("td",null,a(r.id),1),e("td",null,a(r.group_id),1),e("td",null,a(r.user_id),1),e("td",null,a(r.created_at),1),e("td",null,[e("span",{class:"icon-edit-btn ml-1",onClick:n=>i.viewGroupUser(r)},[g(_)],8,ve),i.canEdit?(l(),u("span",{key:0,class:"icon-edit-btn ml-1",onClick:n=>i.viewEditGroupUser(r)},[g(y)],8,Ue)):p("",!0),i.canEdit?(l(),u("span",{key:1,class:"icon-edit-btn danger ml-1",onClick:n=>i.deleteGroupUser(r.id)},[g(v)],8,be)):p("",!0)])]))),128))]),i.hasResult?(l(),u("div",Ee,[e("button",{type:"button",class:"btn pag-btn",disabled:t.offset==1,onClick:s[11]||(s[11]=(...r)=>i.paginateLeft&&i.paginateLeft(...r))},"<",8,Pe),e("span",Ie,"Page: "+a(t.offset)+" / "+a(i.pageCount)+" All Resource: "+a(t.totalCount),1),e("button",{type:"button",class:"btn pag-btn",onClick:s[12]||(s[12]=(...r)=>i.paginatRight&&i.paginatRight(...r)),disabled:t.offset>=i.pageCount},">",8,Ce)])):p("",!0)])),g(I,{show:t.showPswModal,size:"sm",title:"Confirmtion Admin Password",showCancel:!0,onClose:i.cancelAction,onCancel:i.cancelAction,onOk:i.performAction},{default:M(()=>[e("div",null,[s[22]||(s[22]=e("label",{for:"password_input"},[U("Admin Update Password"),e("span",null,"*")],-1)),e("div",ke,[m(e("input",{id:"password_input",type:i.passwordInputType,class:b({"invalid-input":t.missingPassword}),"onUpdate:modelValue":s[13]||(s[13]=r=>t.confirmPsw=r),onInput:s[14]||(s[14]=(...r)=>i.clearErrors&&i.clearErrors(...r))},null,42,Ge),[[B,t.confirmPsw]]),e("button",{type:"button",onClick:s[15]||(s[15]=(...r)=>i.toogleShowPassword&&i.toogleShowPassword(...r))},[e("span",Se,[t.showPassword?(l(),f(P,{key:0})):(l(),f(_,{key:1}))])])]),t.missingPassword?(l(),u("p",Me,"Please Enter your Admin Update Password!")):p("",!0)])]),_:1},8,["show","onClose","onCancel","onOk"]),t.saveSuccess?(l(),f(C,{key:2})):p("",!0),t.saveError?(l(),f(k,{key:3,msg:t.errorMsg},null,8,["msg"])):p("",!0)])}const Ae=G(le,[["render",Te]]),Re={components:{UsersResource:As,GroupsResurce:ne,GroupUsersResource:Ae},data(){return{resource:"USERS"}}},xe={class:"admin-resource-holder"},Le={class:"admin-resource-side"},Ne={class:"admin-resource-content"};function Oe(o,s,h,c,t,i){const D=d("UsersResource"),_=d("GroupsResurce"),y=d("GroupUsersResource");return l(),u("div",xe,[e("div",Le,[e("button",{type:"button",class:b(["resource-btn",{active:t.resource=="USERS"}]),onClick:s[0]||(s[0]=v=>t.resource="USERS")},"Users",2),e("button",{type:"button",class:b(["resource-btn",{active:t.resource=="GROUP"}]),onClick:s[1]||(s[1]=v=>t.resource="GROUP")},"Groups",2),e("button",{type:"button",class:b(["resource-btn",{active:t.resource=="GROUP_USER"}]),onClick:s[2]||(s[2]=v=>t.resource="GROUP_USER")},"Group Users",2),s[3]||(s[3]=e("button",{type:"button",class:"resource-btn"},"Friends",-1)),s[4]||(s[4]=e("button",{type:"button",class:"resource-btn"},"Chat Messages",-1)),s[5]||(s[5]=e("button",{type:"button",class:"resource-btn"},"Logs",-1)),s[6]||(s[6]=e("button",{type:"button",class:"resource-btn"},"Admin Users",-1))]),e("div",Ne,[t.resource=="USERS"?(l(),f(D,{key:0})):p("",!0),t.resource=="GROUP"?(l(),f(_,{key:1})):p("",!0),t.resource=="GROUP_USER"?(l(),f(y,{key:2})):p("",!0)])])}const Ve=G(Re,[["render",Oe]]),Fe={components:{AdminLayout:W,BaseResurce:Ve}};function Be(o,s,h,c,t,i){const D=d("BaseResurce"),_=d("AdminLayout");return l(),f(_,null,{default:M(()=>[g(D)]),_:1})}const Qe=G(Fe,[["render",Be]]);export{Qe as default};
