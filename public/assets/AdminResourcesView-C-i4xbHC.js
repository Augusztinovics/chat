import{A as R}from"./AdminLayout-C3RuLxFM.js";import{I as L,a as V}from"./IconSearch-BP_JDgBd.js";import{c as N,b as B,m as F,f as _,_ as U,s as d,x as i,g as r,h as e,t as u,k as b,l as a,v as p,o as c,i as h,E as D,B as O,D as C,F as z,C as X,w as I,n as P,p as G,q as g}from"./index-9oYURhiR.js";import{I as K,S as q,F as H,M as j}from"./SuccessToast-CYUGQ5gJ.js";import{I as J}from"./IconUser-le8jKett.js";import{a as Q}from"./admin_user-D4eK8ENo.js";import{l as W}from"./LoadingOverlay-Dg6dbrHY.js";const Y={components:{IconSearch:L,IconEyeOpen:N,IconEyeClose:B,IconEdit:K,IconUser:J,IconX:V,SuccessToast:q,FailToast:H,Modal:j},data(){return{users:[],userDetail:null,isEdit:!1,updateId:null,limit:10,offset:1,totalCount:0,searchText:"",submitting:!1,errorMsg:"",saveSuccess:!1,saveError:!1,showPswModal:!1,confirmPsw:"",showPassword:!1,missingPassword:!1,deleteUserId:null}},computed:{...F(Q,W),canEdit(){return this.adminUserStore.roleId>1},usersNum(){return this.users.length},hasResult(){return this.usersNum>0},pageCount(){return this.totalCount<1?0:Math.ceil(this.totalCount/this.limit)},passwordInputType(){return this.showPassword?"text":"password"}},methods:{clearErrors(){this.missingPassword=!1},toogleShowPassword(){this.showPassword=!this.showPassword},paginateLeft(){this.offset<2||(this.offset--,this.fetchUsers(null,this.offset))},paginatRight(){this.offset>=this.pageCount||(this.offset++,this.fetchUsers(null,this.offset))},fetchUsers(l,s=1){let f={s,l:parseInt(this.limit),st:this.searchText};this.loadingStore.startLoading(),_.get("/api/admin/users?"+new URLSearchParams(f).toString()).then(m=>{this.users=m.data.users,this.totalCount=m.data.result_count,this.offset=s,this.loadingStore.finishLoading()}).catch(m=>{this.loadingStore.finishLoading(),console.log(m),this.errorMsg=m.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})},viewUser(l){this.userDetail=l},viewEditUser(l){this.isEdit=!0,this.updateId=l.id,this.userDetail={...l}},closeDetail(){this.isEdit=!1,this.userDetail=null,this.updateId=null},createNewUser(){this.isEdit=!0,this.userDetail={id:0,username:null,password:null,email:null,lg:null,country:null,city:null,description:null,profile_img:null,ip:null,device_data:null,created_at:null}},cancelAction(){this.showPswModal=!1,this.confirmPsw="",this.deleteUserId=null},performAction(){if(this.confirmPsw.length<1){this.missingPassword=!0;return}let l=null;if(this.deleteUserId)l={method:"DELETE",psw:this.confirmPsw,delete_id:this.deleteUserId},this.postData(l);else if(this.isEdit&&this.userDetail)if(this.userDetail.id>0&&this.updateId){if(l={method:"UPDATE",psw:this.confirmPsw},!this.users.find(f=>f.id==this.updateId)){this.showPswModal=!1,this.updateId=null,this.userDetail=null,this.confirmPsw="",this.errorMsg="Unable to find original user!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3);return}{this.errorMsg="Nothing to update!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}}else l={method:"CREATE",psw:this.confirmPsw};else this.cancelAction()},deleteUser(l){this.deleteUserId=l,this.isEdit=!1,this.updateId=null,this.userDetail=null,this.showPswModal=!0,this.focusOnPassword()},saveUser(){this.deleteUserId=null,this.isEdit&&(this.showPswModal=!0,this.focusOnPassword())},focusOnPassword(){setTimeout(()=>{document.getElementById("password_input").focus()},300)},postData(l){this.loadingStore.startLoading(),this.showPswModal=!1,_.post("/api/admin/users",l).then(()=>{this.loadingStore.finishLoading(),this.deleteUserId=null,this.confirmPsw="",this.fetchUsers(null,1),this.saveSuccess=!0,setTimeout(()=>{this.saveSuccess=!1},3e3)}).catch(s=>{this.loadingStore.finishLoading(),this.deleteUserId=null,this.updateId=null,this.userDetail=null,this.confirmPsw="",console.log(s),this.errorMsg=s.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})}}},Z={class:"resurce"},$={key:0,class:"detail-container"},ss={class:"details-header"},es=["readonly"],ts={class:"mt-2"},ns=["src"],os={key:1,class:"icon-lg"},is={class:"detail"},ls={key:0},rs=["readonly"],us=["readonly"],as=["disabled"],ds=["readonly"],cs=["readonly"],ps=["readonly"],ms=["readonly"],hs=["readonly"],fs={key:1},gs={class:"resurce-control"},ys={class:"password-container"},ws=["disabled"],bs=["disabled"],Us={class:"icon"},vs=["onClick"],Es=["onClick"],_s=["onClick"],Ds={key:0,class:"text-center mt-2"},Cs=["disabled"],Is={class:"mr-1 ml-1"},Ps=["disabled"],Ss={class:"password-container"},ks=["type"],Ms={class:"icon"},xs={key:0,class:"invalid-text"};function Ts(l,s,f,m,t,o){const y=d("IconUser"),w=d("IconSearch"),v=d("IconEyeOpen"),S=d("IconEdit"),k=d("IconX"),M=d("IconEyeClose"),x=d("Modal"),T=d("SuccessToast"),A=d("FailToast");return i(),r("div",Z,[t.userDetail?(i(),r("div",$,[e("div",ss,[e("h2",null,[e("span",null,"#"+u(t.userDetail.id),1),s[23]||(s[23]=b()),a(e("input",{type:"text",name:"username",readonly:!t.isEdit,"onUpdate:modelValue":s[0]||(s[0]=n=>t.userDetail.username=n)},null,8,es),[[p,t.userDetail.username]])]),e("div",null,[t.isEdit?(i(),r("button",{key:0,class:"btn btn-success mr-2",onClick:s[1]||(s[1]=(...n)=>o.saveUser&&o.saveUser(...n))},"Save")):c("",!0),e("button",{class:"btn-sm btn-secondary",onClick:s[2]||(s[2]=(...n)=>o.closeDetail&&o.closeDetail(...n))},"X")])]),e("div",ts,[t.userDetail.profile_img?(i(),r("img",{key:0,src:t.userDetail.profile_img,alt:"Profile Image",class:"profile-img md"},null,8,ns)):(i(),r("span",os,[h(y)]))]),e("div",is,[t.userDetail.id==0?(i(),r("p",ls,[s[24]||(s[24]=e("b",null,"Password: ",-1)),a(e("input",{type:"text",name:"pass",readonly:!t.isEdit,"onUpdate:modelValue":s[3]||(s[3]=n=>t.userDetail.password=n)},null,8,rs),[[p,t.userDetail.password]])])):c("",!0),e("p",null,[s[25]||(s[25]=e("b",null,"E-mail: ",-1)),a(e("input",{type:"text",name:"email",readonly:!t.isEdit,"onUpdate:modelValue":s[4]||(s[4]=n=>t.userDetail.email=n)},null,8,us),[[p,t.userDetail.email]])]),e("p",null,[s[27]||(s[27]=e("b",null,"Language: ",-1)),s[28]||(s[28]=b()),a(e("select",{name:"user_lg",id:"user_lg",disabled:!t.isEdit,"onUpdate:modelValue":s[5]||(s[5]=n=>t.userDetail.lg=n)},s[26]||(s[26]=[e("option",{value:"HU"},"Magyar",-1),e("option",{value:"SR"},"Serbian",-1),e("option",{value:"EN"},"English",-1)]),8,as),[[D,t.userDetail.lg]])]),e("p",null,[s[29]||(s[29]=e("b",null,"Country: ",-1)),a(e("input",{type:"text",name:"country",readonly:!t.isEdit,"onUpdate:modelValue":s[6]||(s[6]=n=>t.userDetail.country=n)},null,8,ds),[[p,t.userDetail.country]])]),e("p",null,[s[30]||(s[30]=e("b",null,"City: ",-1)),a(e("input",{type:"text",name:"city",readonly:!t.isEdit,"onUpdate:modelValue":s[7]||(s[7]=n=>t.userDetail.city=n)},null,8,cs),[[p,t.userDetail.city]])]),e("p",null,[s[31]||(s[31]=e("b",null,"Description: ",-1)),a(e("textarea",{name:"description",readonly:!t.isEdit,"onUpdate:modelValue":s[8]||(s[8]=n=>t.userDetail.description=n)},null,8,ps),[[p,t.userDetail.description]])]),e("p",null,[s[32]||(s[32]=e("b",null,"IP: ",-1)),a(e("input",{type:"text",name:"ip",readonly:!t.isEdit,"onUpdate:modelValue":s[9]||(s[9]=n=>t.userDetail.ip=n)},null,8,ms),[[p,t.userDetail.ip]])]),e("p",null,[s[33]||(s[33]=e("b",null,"Device Data: ",-1)),a(e("textarea",{name:"device_data",readonly:!t.isEdit,"onUpdate:modelValue":s[10]||(s[10]=n=>t.userDetail.device_data=n)},null,8,hs),[[p,t.userDetail.device_data]])]),e("p",null,[s[34]||(s[34]=e("b",null,"Created At: ",-1)),b(u(t.userDetail.created_at),1)])])])):(i(),r("div",fs,[s[37]||(s[37]=e("h2",null,"Users",-1)),e("div",gs,[e("div",ys,[a(e("input",{id:"search_input",type:"text","onUpdate:modelValue":s[11]||(s[11]=n=>t.searchText=n),disabled:t.submitting,onKeypress:s[12]||(s[12]=O((...n)=>o.fetchUsers&&o.fetchUsers(...n),["enter"]))},null,40,ws),[[p,t.searchText]]),e("button",{type:"button",onClick:s[13]||(s[13]=(...n)=>o.fetchUsers&&o.fetchUsers(...n)),disabled:t.submitting},[e("span",Us,[h(w)])],8,bs)]),e("div",null,[a(e("select",{name:"pag_size",id:"pag_size","onUpdate:modelValue":s[14]||(s[14]=n=>t.limit=n),onChange:s[15]||(s[15]=(...n)=>o.fetchUsers&&o.fetchUsers(...n))},s[35]||(s[35]=[C('<option value="2">2 / page</option><option value="10">10 / page</option><option value="15">15 / page</option><option value="20">20 / page</option><option value="25">25 / page</option>',5)]),544),[[D,t.limit]]),e("button",{class:"btn-sm btn-primary",onClick:s[16]||(s[16]=(...n)=>o.fetchUsers&&o.fetchUsers(...n))},"Fetch All Users"),o.canEdit?(i(),r("button",{key:0,class:"btn-sm btn-success ml-2",onClick:s[17]||(s[17]=(...n)=>o.createNewUser&&o.createNewUser(...n))},"Create New User")):c("",!0)])]),e("table",null,[s[36]||(s[36]=e("tr",null,[e("th",null,"ID"),e("th",null,"Name"),e("th",null,"E-mail"),e("th",null,"Language"),e("th",null,"Country"),e("th",null,"City"),e("th",null,"Description"),e("th",null,"Created At"),e("th",null,"Actions")],-1)),(i(!0),r(z,null,X(t.users,n=>(i(),r("tr",{key:n.id},[e("td",null,u(n.id),1),e("td",null,u(n.username),1),e("td",null,u(n.email),1),e("td",null,u(n.lg),1),e("td",null,u(n.country),1),e("td",null,u(n.city),1),e("td",null,u(n.description),1),e("td",null,u(n.created_at),1),e("td",null,[e("span",{class:"icon-edit-btn ml-1",onClick:E=>o.viewUser(n)},[h(v)],8,vs),o.canEdit?(i(),r("span",{key:0,class:"icon-edit-btn ml-1",onClick:E=>o.viewEditUser(n)},[h(S)],8,Es)):c("",!0),o.canEdit?(i(),r("span",{key:1,class:"icon-edit-btn danger ml-1",onClick:E=>o.deleteUser(n.id)},[h(k)],8,_s)):c("",!0)])]))),128))]),o.hasResult?(i(),r("div",Ds,[e("button",{type:"button",class:"btn pag-btn",disabled:t.offset==1,onClick:s[18]||(s[18]=(...n)=>o.paginateLeft&&o.paginateLeft(...n))},"<",8,Cs),e("span",Is,"Page: "+u(t.offset)+" / "+u(o.pageCount)+" All Resource: "+u(t.totalCount),1),e("button",{type:"button",class:"btn pag-btn",onClick:s[19]||(s[19]=(...n)=>o.paginatRight&&o.paginatRight(...n)),disabled:t.offset>=o.pageCount},">",8,Ps)])):c("",!0)])),h(x,{show:t.showPswModal,size:"sm",title:"Confirmtion Admin Password",showCancel:!0,onClose:o.cancelAction,onCancel:o.cancelAction,onOk:o.performAction},{default:I(()=>[e("div",null,[s[38]||(s[38]=e("label",{for:"password_input"},[b("Admin Update Password"),e("span",null,"*")],-1)),e("div",Ss,[a(e("input",{id:"password_input",type:o.passwordInputType,class:P({"invalid-input":t.missingPassword}),"onUpdate:modelValue":s[20]||(s[20]=n=>t.confirmPsw=n),onInput:s[21]||(s[21]=(...n)=>o.clearErrors&&o.clearErrors(...n))},null,42,ks),[[G,t.confirmPsw]]),e("button",{type:"button",onClick:s[22]||(s[22]=(...n)=>o.toogleShowPassword&&o.toogleShowPassword(...n))},[e("span",Ms,[t.showPassword?(i(),g(M,{key:0})):(i(),g(v,{key:1}))])])]),t.missingPassword?(i(),r("p",xs,"Please Enter your Admin Update Password!")):c("",!0)])]),_:1},8,["show","onClose","onCancel","onOk"]),t.saveSuccess?(i(),g(T,{key:2})):c("",!0),t.saveError?(i(),g(A,{key:3,msg:t.errorMsg},null,8,["msg"])):c("",!0)])}const As=U(Y,[["render",Ts]]),Rs={components:{UsersResource:As},data(){return{resource:"USERS"}}},Ls={class:"admin-resource-holder"},Vs={class:"admin-resource-side"},Ns={class:"admin-resource-content"};function Bs(l,s,f,m,t,o){const y=d("UsersResource");return i(),r("div",Ls,[e("div",Vs,[e("button",{type:"button",class:P(["resource-btn",{active:t.resource=="USERS"}]),onClick:s[0]||(s[0]=w=>t.resource="USERS")},"Users",2),s[1]||(s[1]=C('<button type="button" class="resource-btn">Groups</button><button type="button" class="resource-btn">Group Users</button><button type="button" class="resource-btn">Friends</button><button type="button" class="resource-btn">Chat Messages</button><button type="button" class="resource-btn">Logs</button><button type="button" class="resource-btn">Admin Users</button>',6))]),e("div",Ns,[t.resource=="USERS"?(i(),g(y,{key:0})):c("",!0)])])}const Fs=U(Rs,[["render",Bs]]),Os={components:{AdminLayout:R,BaseResurce:Fs}};function zs(l,s,f,m,t,o){const y=d("BaseResurce"),w=d("AdminLayout");return i(),g(w,null,{default:I(()=>[h(y)]),_:1})}const Qs=U(Os,[["render",zs]]);export{Qs as default};
