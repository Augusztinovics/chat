import{A as R}from"./AdminLayout-BhLEb_PP.js";import{I as L,a as V}from"./IconSearch-CE39pHXO.js";import{c as N,b as B,m as F,f as E,_ as b,s as m,x as n,g as o,h as s,t as a,k as w,l as d,v as p,o as c,i as f,E as _,B as O,D as C,F as q,C as z,w as I,n as P,p as X,q as g}from"./index-CGukCU_x.js";import{I as G,S as K,F as H,M as j}from"./SuccessToast-BxDVRYnB.js";import{I as J}from"./IconUser-j5HOKuAU.js";import{a as Q}from"./admin_user-DYf_Vsnk.js";import{l as W}from"./LoadingOverlay-CCxz1Ocn.js";const Y={components:{IconSearch:L,IconEyeOpen:N,IconEyeClose:B,IconEdit:G,IconUser:J,IconX:V,SuccessToast:K,FailToast:H,Modal:j},data(){return{users:[],userDetail:null,isEdit:!1,updateId:null,limit:10,offset:1,totalCount:0,searchText:"",submitting:!1,errorMsg:"",saveSuccess:!1,saveError:!1,showPswModal:!1,confirmPsw:"",showPassword:!1,missingPassword:!1,deleteUserId:null}},computed:{...F(Q,W),canEdit(){return this.adminUserStore.roleId>1},usersNum(){return this.users.length},hasResult(){return this.usersNum>0},pageCount(){return this.totalCount<1?0:Math.ceil(this.totalCount/this.limit)},passwordInputType(){return this.showPassword?"text":"password"}},methods:{clearErrors(){this.missingPassword=!1},toogleShowPassword(){this.showPassword=!this.showPassword},paginateLeft(){this.offset<2||(this.offset--,this.fetchUsers(null,this.offset))},paginatRight(){this.offset>=this.pageCount||(this.offset++,this.fetchUsers(null,this.offset))},fetchUsers(l,e=1){let u={s:e,l:parseInt(this.limit),st:this.searchText};this.loadingStore.startLoading(),E.get("/api/admin/users?"+new URLSearchParams(u).toString()).then(h=>{this.users=h.data.users,this.totalCount=h.data.result_count,this.offset=e,this.loadingStore.finishLoading()}).catch(h=>{this.loadingStore.finishLoading(),console.log(h),this.errorMsg=h.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})},viewUser(l){this.userDetail=l},viewEditUser(l){this.isEdit=!0,this.updateId=l.id,this.userDetail={...l}},closeDetail(){this.isEdit=!1,this.userDetail=null,this.updateId=null},createNewUser(){this.isEdit=!0,this.userDetail={id:0,username:null,password:null,email:null,lg:null,country:null,city:null,description:null,profile_img:null,ip:null,device_data:null,created_at:null}},cancelAction(){this.showPswModal=!1,this.confirmPsw="",this.deleteUserId=null},performAction(){if(this.confirmPsw.length<1){this.missingPassword=!0;return}let l=null;if(this.deleteUserId)l={method:"DELETE",psw:this.confirmPsw,delete_id:this.deleteUserId},this.postData(l);else if(this.isEdit&&this.userDetail)if(this.userDetail.id>0&&this.updateId){l={method:"UPDATE",psw:this.confirmPsw,user_id:this.userDetail.id};let e=this.users.find(h=>h.id==this.updateId);if(!e){this.showPswModal=!1,this.updateId=null,this.userDetail=null,this.confirmPsw="",this.errorMsg="Unable to find original user!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3);return}let u=!1;if(e.username!==this.userDetail.username.trim()&&(l.username=this.userDetail.username.trim(),u=!0),this.userDetail.email&&e.email!==this.userDetail.email&&this.userDetail.email.trim().length>6&&this.userDetail.email.includes("@")&&(l.email=this.userDetail.email.trim(),u=!0),e.lg!==this.userDetail.lg&&(l.lg=this.userDetail.lg,u=!0),this.userDetail.country&&e.country!==this.userDetail.country.trim()&&(l.country=this.userDetail.country.trim(),u=!0),this.userDetail.city&&e.city!==this.userDetail.city.trim()&&(l.city=this.userDetail.city.trim(),u=!0),this.userDetail.description&&e.description!==this.userDetail.description.trim()&&(l.description=this.userDetail.description.trim(),u=!0),this.userDetail.ip&&e.ip!==this.userDetail.ip.trim()&&(l.ip=this.userDetail.ip.trim(),u=!0),this.userDetail.device_data&&e.device_data!==this.userDetail.device_data.trim()&&(l.device_data=this.userDetail.device_data.trim(),u=!0),u)this.postData(l);else{this.errorMsg="Nothing to update!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}}else{if(l={method:"CREATE",psw:this.confirmPsw},this.userDetail.username&&this.userDetail.username.trim().length>0)l.username=this.userDetail.username.trim();else{this.errorMsg="Username is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}if(this.userDetail.password&&this.userDetail.password.trim().length>5)l.password=this.userDetail.password.trim();else{this.errorMsg="Password is required! And 6 or more character",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}if(this.userDetail.email&&this.userDetail.email.trim().length>6&&this.userDetail.email.includes("@")&&(l.email=this.userDetail.email.trim()),this.userDetail.lg)l.lg=this.userDetail.lg;else{this.errorMsg="Language is required!",this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},3e3);return}this.userDetail.country&&this.userDetail.country.trim().length>0&&(l.country=this.userDetail.country.trim()),this.userDetail.city&&this.userDetail.city.trim().length>0&&(l.city=this.userDetail.city.trim()),this.userDetail.description&&this.userDetail.description.trim().length>0&&(l.description=this.userDetail.description.trim()),this.userDetail.ip&&this.userDetail.ip.trim().length>0&&(l.ip=this.userDetail.ip.trim()),this.userDetail.device_data&&this.userDetail.device_data.trim().length>0&&(l.device_data=this.userDetail.device_data.trim()),this.postData(l)}else this.cancelAction()},deleteUser(l){this.deleteUserId=l,this.isEdit=!1,this.updateId=null,this.userDetail=null,this.showPswModal=!0,this.focusOnPassword()},saveUser(){this.deleteUserId=null,this.isEdit&&(this.showPswModal=!0,this.focusOnPassword())},focusOnPassword(){setTimeout(()=>{document.getElementById("password_input").focus()},300)},postData(l){this.loadingStore.startLoading(),this.showPswModal=!1,E.post("/api/admin/users",l).then(()=>{this.loadingStore.finishLoading(),this.deleteUserId=null,this.confirmPsw="",this.fetchUsers(null,1),this.saveSuccess=!0,setTimeout(()=>{this.saveSuccess=!1},3e3)}).catch(e=>{this.loadingStore.finishLoading(),this.deleteUserId=null,this.updateId=null,this.userDetail=null,this.confirmPsw="",console.log(e),this.errorMsg=e.message,this.saveError=!0,setTimeout(()=>{this.errorMsg="",this.saveError=!1},5e3)})}}},Z={class:"resurce"},$={key:0,class:"detail-container"},ee={class:"details-header"},se=["readonly"],te={class:"mt-2"},ie=["src"],re={key:1,class:"icon-lg"},le={class:"detail"},ne={key:0},oe=["readonly"],ue=["readonly"],ae=["disabled"],de=["readonly"],me=["readonly"],he=["readonly"],ce=["readonly"],pe=["readonly"],fe={key:1},ge={class:"resurce-control"},ye={class:"password-container"},De=["disabled"],we=["disabled"],be={class:"icon"},ve=["onClick"],Ue=["onClick"],Ee=["onClick"],_e={key:0,class:"text-center mt-2"},Ce=["disabled"],Ie={class:"mr-1 ml-1"},Pe=["disabled"],Se={class:"password-container"},ke=["type"],Me={class:"icon"},xe={key:0,class:"invalid-text"};function Te(l,e,u,h,t,r){const y=m("IconUser"),D=m("IconSearch"),v=m("IconEyeOpen"),S=m("IconEdit"),k=m("IconX"),M=m("IconEyeClose"),x=m("Modal"),T=m("SuccessToast"),A=m("FailToast");return n(),o("div",Z,[t.userDetail?(n(),o("div",$,[s("div",ee,[s("h2",null,[s("span",null,"#"+a(t.userDetail.id),1),e[23]||(e[23]=w()),d(s("input",{type:"text",name:"username",readonly:!t.isEdit,"onUpdate:modelValue":e[0]||(e[0]=i=>t.userDetail.username=i)},null,8,se),[[p,t.userDetail.username]])]),s("div",null,[t.isEdit?(n(),o("button",{key:0,class:"btn btn-success mr-2",onClick:e[1]||(e[1]=(...i)=>r.saveUser&&r.saveUser(...i))},"Save")):c("",!0),s("button",{class:"btn-sm btn-secondary",onClick:e[2]||(e[2]=(...i)=>r.closeDetail&&r.closeDetail(...i))},"X")])]),s("div",te,[t.userDetail.profile_img?(n(),o("img",{key:0,src:t.userDetail.profile_img,alt:"Profile Image",class:"profile-img md"},null,8,ie)):(n(),o("span",re,[f(y)]))]),s("div",le,[t.userDetail.id==0?(n(),o("p",ne,[e[24]||(e[24]=s("b",null,"Password: ",-1)),d(s("input",{type:"text",name:"pass",readonly:!t.isEdit,"onUpdate:modelValue":e[3]||(e[3]=i=>t.userDetail.password=i)},null,8,oe),[[p,t.userDetail.password]])])):c("",!0),s("p",null,[e[25]||(e[25]=s("b",null,"E-mail: ",-1)),d(s("input",{type:"text",name:"email",readonly:!t.isEdit,"onUpdate:modelValue":e[4]||(e[4]=i=>t.userDetail.email=i)},null,8,ue),[[p,t.userDetail.email]])]),s("p",null,[e[27]||(e[27]=s("b",null,"Language: ",-1)),e[28]||(e[28]=w()),d(s("select",{name:"user_lg",id:"user_lg",disabled:!t.isEdit,"onUpdate:modelValue":e[5]||(e[5]=i=>t.userDetail.lg=i)},e[26]||(e[26]=[s("option",{value:"HU"},"Magyar",-1),s("option",{value:"SR"},"Serbian",-1),s("option",{value:"EN"},"English",-1)]),8,ae),[[_,t.userDetail.lg]])]),s("p",null,[e[29]||(e[29]=s("b",null,"Country: ",-1)),d(s("input",{type:"text",name:"country",readonly:!t.isEdit,"onUpdate:modelValue":e[6]||(e[6]=i=>t.userDetail.country=i)},null,8,de),[[p,t.userDetail.country]])]),s("p",null,[e[30]||(e[30]=s("b",null,"City: ",-1)),d(s("input",{type:"text",name:"city",readonly:!t.isEdit,"onUpdate:modelValue":e[7]||(e[7]=i=>t.userDetail.city=i)},null,8,me),[[p,t.userDetail.city]])]),s("p",null,[e[31]||(e[31]=s("b",null,"Description: ",-1)),d(s("textarea",{name:"description",readonly:!t.isEdit,"onUpdate:modelValue":e[8]||(e[8]=i=>t.userDetail.description=i)},null,8,he),[[p,t.userDetail.description]])]),s("p",null,[e[32]||(e[32]=s("b",null,"IP: ",-1)),d(s("input",{type:"text",name:"ip",readonly:!t.isEdit,"onUpdate:modelValue":e[9]||(e[9]=i=>t.userDetail.ip=i)},null,8,ce),[[p,t.userDetail.ip]])]),s("p",null,[e[33]||(e[33]=s("b",null,"Device Data: ",-1)),d(s("textarea",{name:"device_data",readonly:!t.isEdit,"onUpdate:modelValue":e[10]||(e[10]=i=>t.userDetail.device_data=i)},null,8,pe),[[p,t.userDetail.device_data]])]),s("p",null,[e[34]||(e[34]=s("b",null,"Created At: ",-1)),w(a(t.userDetail.created_at),1)])])])):(n(),o("div",fe,[e[37]||(e[37]=s("h2",null,"Users",-1)),s("div",ge,[s("div",ye,[d(s("input",{id:"search_input",type:"text","onUpdate:modelValue":e[11]||(e[11]=i=>t.searchText=i),disabled:t.submitting,onKeypress:e[12]||(e[12]=O((...i)=>r.fetchUsers&&r.fetchUsers(...i),["enter"]))},null,40,De),[[p,t.searchText]]),s("button",{type:"button",onClick:e[13]||(e[13]=(...i)=>r.fetchUsers&&r.fetchUsers(...i)),disabled:t.submitting},[s("span",be,[f(D)])],8,we)]),s("div",null,[d(s("select",{name:"pag_size",id:"pag_size","onUpdate:modelValue":e[14]||(e[14]=i=>t.limit=i),onChange:e[15]||(e[15]=(...i)=>r.fetchUsers&&r.fetchUsers(...i))},e[35]||(e[35]=[C('<option value="2">2 / page</option><option value="10">10 / page</option><option value="15">15 / page</option><option value="20">20 / page</option><option value="25">25 / page</option>',5)]),544),[[_,t.limit]]),s("button",{class:"btn-sm btn-primary",onClick:e[16]||(e[16]=(...i)=>r.fetchUsers&&r.fetchUsers(...i))},"Fetch All Users"),r.canEdit?(n(),o("button",{key:0,class:"btn-sm btn-success ml-2",onClick:e[17]||(e[17]=(...i)=>r.createNewUser&&r.createNewUser(...i))},"Create New User")):c("",!0)])]),s("table",null,[e[36]||(e[36]=s("tr",null,[s("th",null,"ID"),s("th",null,"Name"),s("th",null,"E-mail"),s("th",null,"Language"),s("th",null,"Country"),s("th",null,"City"),s("th",null,"Description"),s("th",null,"Created At"),s("th",null,"Actions")],-1)),(n(!0),o(q,null,z(t.users,i=>(n(),o("tr",{key:i.id},[s("td",null,a(i.id),1),s("td",null,a(i.username),1),s("td",null,a(i.email),1),s("td",null,a(i.lg),1),s("td",null,a(i.country),1),s("td",null,a(i.city),1),s("td",null,a(i.description),1),s("td",null,a(i.created_at),1),s("td",null,[s("span",{class:"icon-edit-btn ml-1",onClick:U=>r.viewUser(i)},[f(v)],8,ve),r.canEdit?(n(),o("span",{key:0,class:"icon-edit-btn ml-1",onClick:U=>r.viewEditUser(i)},[f(S)],8,Ue)):c("",!0),r.canEdit?(n(),o("span",{key:1,class:"icon-edit-btn danger ml-1",onClick:U=>r.deleteUser(i.id)},[f(k)],8,Ee)):c("",!0)])]))),128))]),r.hasResult?(n(),o("div",_e,[s("button",{type:"button",class:"btn pag-btn",disabled:t.offset==1,onClick:e[18]||(e[18]=(...i)=>r.paginateLeft&&r.paginateLeft(...i))},"<",8,Ce),s("span",Ie,"Page: "+a(t.offset)+" / "+a(r.pageCount)+" All Resource: "+a(t.totalCount),1),s("button",{type:"button",class:"btn pag-btn",onClick:e[19]||(e[19]=(...i)=>r.paginatRight&&r.paginatRight(...i)),disabled:t.offset>=r.pageCount},">",8,Pe)])):c("",!0)])),f(x,{show:t.showPswModal,size:"sm",title:"Confirmtion Admin Password",showCancel:!0,onClose:r.cancelAction,onCancel:r.cancelAction,onOk:r.performAction},{default:I(()=>[s("div",null,[e[38]||(e[38]=s("label",{for:"password_input"},[w("Admin Update Password"),s("span",null,"*")],-1)),s("div",Se,[d(s("input",{id:"password_input",type:r.passwordInputType,class:P({"invalid-input":t.missingPassword}),"onUpdate:modelValue":e[20]||(e[20]=i=>t.confirmPsw=i),onInput:e[21]||(e[21]=(...i)=>r.clearErrors&&r.clearErrors(...i))},null,42,ke),[[X,t.confirmPsw]]),s("button",{type:"button",onClick:e[22]||(e[22]=(...i)=>r.toogleShowPassword&&r.toogleShowPassword(...i))},[s("span",Me,[t.showPassword?(n(),g(M,{key:0})):(n(),g(v,{key:1}))])])]),t.missingPassword?(n(),o("p",xe,"Please Enter your Admin Update Password!")):c("",!0)])]),_:1},8,["show","onClose","onCancel","onOk"]),t.saveSuccess?(n(),g(T,{key:2})):c("",!0),t.saveError?(n(),g(A,{key:3,msg:t.errorMsg},null,8,["msg"])):c("",!0)])}const Ae=b(Y,[["render",Te]]),Re={components:{UsersResource:Ae},data(){return{resource:"USERS"}}},Le={class:"admin-resource-holder"},Ve={class:"admin-resource-side"},Ne={class:"admin-resource-content"};function Be(l,e,u,h,t,r){const y=m("UsersResource");return n(),o("div",Le,[s("div",Ve,[s("button",{type:"button",class:P(["resource-btn",{active:t.resource=="USERS"}]),onClick:e[0]||(e[0]=D=>t.resource="USERS")},"Users",2),e[1]||(e[1]=C('<button type="button" class="resource-btn">Groups</button><button type="button" class="resource-btn">Group Users</button><button type="button" class="resource-btn">Friends</button><button type="button" class="resource-btn">Chat Messages</button><button type="button" class="resource-btn">Logs</button><button type="button" class="resource-btn">Admin Users</button>',6))]),s("div",Ne,[t.resource=="USERS"?(n(),g(y,{key:0})):c("",!0)])])}const Fe=b(Re,[["render",Be]]),Oe={components:{AdminLayout:R,BaseResurce:Fe}};function qe(l,e,u,h,t,r){const y=m("BaseResurce"),D=m("AdminLayout");return n(),g(D,null,{default:I(()=>[f(y)]),_:1})}const Qe=b(Oe,[["render",qe]]);export{Qe as default};
